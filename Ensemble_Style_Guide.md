# Ensemble Style Guide (取扱説明書)

このドキュメントは、`ensemble_styles.xlsx` を使用してMIDIアンサンブル生成ツールの伴奏パターン（スタイル）を定義・作成する方法をまとめたものです。

## 📁 ファイルの場所
`EnsembleGenerator/ensemble_styles.xlsx`

## 📝 データの構造
1つのスタイル（伴奏パターン）は、**「Voice（レイヤー）」** と **「Type（パラメータ）」** の組み合わせによって複数の行で構成されます。1行につき最大32ステップ（2小節分）まで定義可能です。

### 列（カラム）の説明
| style_name | voice | type | 01 - 32 | swing |
| :--- | :--- | :--- | :--- | :--- |
| パターン名 | レイヤーNo. | 行の種類 | 各ステップの値 | スウィング値 |

1.  **style_name**: パターンの名前（例: `Trance`, `Piano_Ballad`）。同じ名前の行は1つのセットとして扱われます。
2.  **voice**: レイヤー番号（1, 2, 3...）。
    *   複数の音を同時に鳴らしたい場合（例：左手と右手）は、Voice番号を変えて行を追加します。
    *   Voice 1でコード、Voice 2でメロディ、といった使い分けが可能です。
3.  **type**: その行が何のデータを表すか指定します。以下の3種類で1セットです。
    *   **`seq`**: 音程（どのコード構成音を弾くか）
    *   **`gate`**: 音の長さ（サスティン）
    *   **`vel`**: 音の強さ（ベロシティ）
4.  **01 ～ 32**: 16分音符ごとのステップデータです。
5.  **swing**: スウィング感（0.0 ～ 0.5）。`seq` の行にのみ入力します。

---

## 🔢 値の入力ルール

### 1. seq (音程)
数字は「ドレミ」ではなく、**「コード構成音の何番目か」** を指定します。これにより、どんなコード（C, Fm7, G7...）が来ても自動的に正しい音に変換されます。

*   **`0`**: ルート音 (Root)
*   **`1`**: 次の構成音 (3rdなど)
*   **`2`**: その次の構成音 (5thなど)
*   **`3`**: さらに次の構成音 (7thやOctave)
*   **`-1` または `空欄`**: 休符
*   **`0, 2`**: カンマ区切りで複数の音を同時に指定可能（和音）。

### 2. gate (音の長さ)
**基準値は「10」** です（10 = 16分音符1つ分）。
入力されたベース音が短くても、ここで指定した長さだけ音が伸びます。

*   **`5`**: スタッカート（16分音符の半分）
*   **`10`**: 16分音符（1.0倍）
*   **`20`**: 8分音符（2.0倍）
*   **`40`**: 4分音符（1拍）
*   **`80`**: 2分音符（2拍）
*   **`160`**: 全音符（4拍 / 1小節）

### 3. vel (音の強さ)
**基準値は「10」** です。元のベロシティに対する倍率です。

*   **`10`**: そのまま（1.0倍）
*   **`12`**: アクセント（1.2倍）
*   **`8`**: 弱く（0.8倍）

---

## 🎯 設定例

### 例1：トランス風アルペジオ (Trance)
16分音符で刻み続ける、典型的なパターンです。

| style_name | voice | type | 01 | 02 | 03 | 04 | ... |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Trance** | 1 | seq | 0 | 1 | 2 | 1 | ... |
| **Trance** | 1 | gate | 5 | 5 | 5 | 5 | ... |
| **Trance** | 1 | vel | 12 | 10 | 10 | 10 | ... |

*(解説: スタッカート(`gate:5`)で、拍の頭(`01`)にアクセント(`vel:12`)を入れています)*

### 例2：白玉パッド (Pad)
コードを長く伸ばします。

| style_name | voice | type | 01 | 02 | ... |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Pad** | 1 | seq | 0, 2, 4 | -1 | ... |
| **Pad** | 1 | gate | 160 | 10 | ... |
| **Pad** | 1 | vel | 8 | 10 | ... |

*(解説: `seq`に`0, 2, 4`と書いて和音にし、`gate`を`160`(全音符)にして長く伸ばしています)*

### 例3：ピアノ伴奏 (Piano_Ballad)
左手でルート、右手でコードバッキング。

| style_name | voice | type | 01 | 02 | 03 | ... |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Piano** | 1 | seq | 0 | -1 | -1 | ... |
| **Piano** | 1 | gate | 40 | ... | ... | ... |
| **Piano** | 2 | seq | -1 | 1, 2 | 1, 2 | ... |
| **Piano** | 2 | gate | ... | 10 | 10 | ... |

*(解説: Voice 1がルート音、Voice 2が和音を担当します)*
